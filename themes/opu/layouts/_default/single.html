{{ define "main" }}
<div class="relative lg:h-[60vh] h-screen pt-16">
  <div class="absolute inset-0 bg-black opacity-60 z-10"></div>
  <div id="blog-background" class="absolute inset-0 bg-cover bg-center"
    style="background-image: url('{{ .Params.featured_image }}')">
  </div>

  <div id="dots-container" class="absolute inset-0 z-20"></div>

  <div
    class="relative z-30 container mx-auto px-4 h-full flex flex-col justify-center items-start text-left text-white">
    <p class="text-sm uppercase tracking-widest mb-20 flex items-center">
      {{ .Section | upper }} <span class="ml-2 inline-block w-12 h-px bg-white"></span>
    </p>
    <h1 class="text-4xl md:text-5xl font-bold mb-6 max-w-3xl leading-tight">
      {{ .Title }}
    </h1>
  </div>
</div>

<!-- Blog Section -->
<section class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto relative flex gap-8">
      <!-- Main Content -->
      <div class="flex-1">
        <!-- Blog Post Body -->
        <div class="prose prose-lg max-w-none">
          {{ .Content }}
        </div>
      </div>

      <!-- Sticky Sidebar -->
      <aside class="hidden md:block w-64 sticky top-24 self-start">
        <!-- Tags -->
        <div class="mb-8">
          <h4 class="text-gray-700 font-semibold mb-3">Tags</h4>
          <div class="flex flex-wrap gap-2">
            {{ range .Params.tags }}
            <a href="/tags/{{ . | urlize }}"
              class="inline-block bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-blue-100">
              {{ . }}
            </a>
            {{ end }}
          </div>
        </div>

        <!-- Share Icons -->
        <div>
          <h4 class="text-gray-700 font-semibold mb-3">Share</h4>
          <div class="flex flex-col space-y-3">
            <a href="https://facebook.com/sharer/sharer.php?u={{ .Permalink | absURL }}"
              class="text-gray-600 hover:text-blue-600 transition-colors">
              <i class="fab fa-facebook-f w-4"></i>
              <span class="ml-2">Share on Facebook</span>
            </a>
            <a href="https://twitter.com/intent/tweet?url={{ .Permalink | absURL }}&text={{ .Title }}"
              class="text-gray-600 hover:text-blue-600 transition-colors">
              <i class="fab fa-twitter w-4"></i>
              <span class="ml-2">Share on Twitter</span>
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ .Permalink | absURL }}&title={{ .Title }}"
              class="text-gray-600 hover:text-blue-600 transition-colors">
              <i class="fab fa-linkedin-in w-4"></i>
              <span class="ml-2">Share on LinkedIn</span>
            </a>
            <a href="mailto:?subject={{ .Title }}&body={{ .Permalink | absURL }}"
              class="text-gray-600 hover:text-blue-600 transition-colors">
              <i class="far fa-envelope w-4"></i>
              <span class="ml-2">Share via Email</span>
            </a>
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>

<!-- Related Blogs Section -->
<section class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-blue-900 mb-6">Related blog posts</h2>
      <p class="text-xl text-gray-700 max-w-3xl mx-auto">
        Stay updated with the latest trends, case studies, and insights about data collection in Africa.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {{ $currentPage := . }}
      {{ $tags := .Params.tags }}
      {{ $related := slice }}
      {{ range .Site.RegularPages }}
      {{ if and (ne .Permalink $currentPage.Permalink) (eq .Type "posts") }}
      {{ $matches := intersect .Params.tags $tags | len }}
      {{ if gt $matches 0 }}
      {{ $related = $related | append . }}
      {{ end }}
      {{ end }}
      {{ end }}

      {{ range first 3 $related }}
      <div class="rounded-lg overflow-hidden border border-gray-200 transition-all duration-300">
        <div class="overflow-hidden">
          {{ with .Params.featured_image }}
          <a href="{{ .RelPermalink }}">
            <img src="{{ . }}" alt="{{ $.Title }}"
              class="w-full h-56 object-cover blog-image transition-transform duration-500 hover:scale-105" />
          </a>
          {{ end }}
        </div>
        <div class="p-6">
          <div class="flex items-center text-sm text-gray-500 mb-2">
            <span class="mr-3"><i class="far fa-calendar-alt mr-1"></i>{{ .Date.Format "January 2, 2006" }}</span>
            <span><i class="far fa-user mr-1"></i>By {{ .Params.author.name | default "Admin" }}</span>
          </div>
          <a href="{{ .RelPermalink }}" class="block group">
            <h3 class="text-xl font-bold text-blue-900 mb-3 group-hover:text-blue-600 transition">
              {{ .Title }}
            </h3>
          </a>
          <p class="text-gray-700 mb-4">
            {{ .Summary | truncate 120 }}
          </p>
          <a href="{{ .RelPermalink }}" class="inline-block text-blue-600 font-medium hover:text-blue-800 transition">
            Read More <i class="fas fa-arrow-right ml-1 text-sm"></i>
          </a>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}